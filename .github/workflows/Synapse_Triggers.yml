name: Dev_Start_Stop_Synapse_Triggers
on: [push]
env:
  clientAppId: '${{ secrets.CLIENT_ID }}'
  clientAppSecret: '${{ secrets.CLIENT_SECRET }}'
  subscriptionId: '${{ secrets.SUBSCRIPTION_ID}}'
  tenantId: '${{ secrets.TENANT_ID}}'
  TargetResourceGroup: "RG-Metrolinx"
  TargetWorkspaceName: "testtriggerautomate"
jobs:
  release:
    runs-on: windows-latest
    environment: dev
    steps:
      - uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
          enable-AzPSSession: true
      - name: Checkout
        uses: actions/checkout@v3
      - name: Synapse Start Dev Trigger 
        run: |
         foreach($file in Get-ChildItem -Path ${{ env.artifactDirectory }}\${{ env.triggerPath }}\*.json -Name)
         {
           $trigger = Get-Content -Raw ${{ env.artifactDirectory }}\${{ env.triggerPath }}\$file | ConvertFrom-Json  
           if(([string](az synapse trigger list --workspace-name ${{ vars.MX_SYNAPSE_WORKSPACE }} --query [].name) -match $trigger.name))
           {
             #az synapse trigger start --workspace-name ${{ vars.MX_SYNAPSE_WORKSPACE }} --name $trigger.name
             az synapse trigger resume --workspace-name  ${{ vars.MX_SYNAPSE_WORKSPACE }} --name $trigger.name
             echo "Trigger started"$trigger.name
           }          
         }
